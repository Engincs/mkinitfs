#!/usr/bin/env atf-sh

. $(atf_get_srcdir)/test_env.sh

init_tests \
	mkinitfs_help \
	mkinitfs_invalid_opt \
	mkinitfs_list_features \
	mkinitfs_list_files \

mkinitfs_help_body() {
	atf_check -o match:"usage:" mkinitfs -h
}

mkinitfs_invalid_opt_body() {
	atf_check -s exit:1 -e match:"usage" \
		mkinitfs -Z
}

mkinitfs_invalid_opt_body() {
	atf_check -s exit:1 -e match:"usage" \
		mkinitfs -Z
}

mkinitfs_list_features_body() {
	mkdir -p etc/mkinitfs/features.d
	touch etc/mkinitfs/features.d/myfeature1.files
	touch etc/mkinitfs/features.d/myfeature2.modules

	features_dir="$PWD"/etc/mkinitfs/features.d atf_check \
		-o match:"myfeature1" \
		-o match:"myfeature2" \
		mkinitfs -b "$PWD" -L
}

mkinitfs_list_files_body() {
	mkdir -p etc/mkinitfs/features.d
	touch testfile
	echo "/testfile" > etc/mkinitfs/features.d/myfiles.files
	DATADIR="$srcdir" atf_check \
		-o match:"testfile" \
		mkinitfs -b "$PWD" -P "$PWD/etc/mkinitfs/features.d" -n -F myfiles -l
}
